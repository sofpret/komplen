<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Laporan Trouble Rz.Speed</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Inter', sans-serif;
  margin: 0;
  padding: 0;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: linear-gradient(145deg,#a8edea,#fed6e3);
}

.container {
  background: white;
  padding: 30px;
  width: 400px;
  border-radius: 25px;
  box-shadow: 0 15px 35px rgba(0,0,0,0.15);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.container:hover {
  transform: translateY(-3px);
  box-shadow: 0 25px 45px rgba(0,0,0,0.2);
}

h1 {
  text-align: center;
  color: #2f855a;
  margin-bottom: 8px;
  font-size: 24px;
}

.time {
  text-align: center;
  font-size: 13px;
  color: #718096;
  margin-bottom: 20px;
}

input, textarea {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 12px;
  border: 1px solid #cbd5e0;
  outline: none;
  font-size: 14px;
  transition: all 0.3s ease;
}
input:focus, textarea:focus {
  border-color: #38b2ac;
  box-shadow: 0 0 10px rgba(56,178,172,0.3);
}

button {
  width: 100%;
  margin-top: 18px;
  padding: 12px;
  border: none;
  border-radius: 15px;
  background: linear-gradient(135deg,#38b2ac,#63b3ed);
  color: white;
  font-weight: 600;
  font-size: 15px;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: all 0.3s ease;
}
button:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(0,0,0,0.2);
}

.spinner {
  border: 3px solid #f3f3f3;
  border-top: 3px solid white;
  border-radius: 50%;
  width: 16px;
  height: 16px;
  animation: spin 1s linear infinite;
  margin-left: 10px;
  display: none;
}

.success {
  text-align: center;
  display: none;
}
.success h2 {
  color: #2b6cb0;
  margin-bottom: 12px;
}
.success p {
  font-size: 14px;
  color: #2d3748;
}

@keyframes spin {
  from {transform: rotate(0deg);}
  to {transform: rotate(360deg);}
}
</style>
</head>
<body>

<div class="container" id="formBox">
<h1>Laporan Trouble Rz.Speed</h1>
<div class="time" id="datetime"></div>

<input type="text" id="nama" placeholder="Nama Pelanggan" required>
<input type="text" id="alamat" placeholder="Alamat Lengkap" required>
<textarea id="keluhan" placeholder="Jelaskan kendala..." rows="4" required></textarea>
<input type="file" id="foto" accept="image/*" capture="environment">

<button id="btnKirim" onclick="kirim()">
  Kirim Laporan
  <div class="spinner" id="spinner"></div>
</button>
</div>

<div class="container success" id="successBox">
<h2>âœ… Laporan Berhasil Dikirim</h2>
<p>
Terima kasih telah melaporkan kendala Anda.<br><br>
Laporan diterima dan sedang diproses tim teknisi Rz.Speed.<br>
Teknisi akan segera menuju lokasi.<br><br>
Pastikan nomor & alamat bisa dihubungi.<br><br>
Salam cepat & stabil ðŸš€
</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.28.1/dist/supabase.min.js"></script>
<script>
// ===== Supabase init =====
const supabase = Supabase.createClient("https://dupfwtfhfqmjrhhpznvr.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR1cGZ3dGZoZnFtanJoaHB6bnZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4Nzc1MTcsImV4cCI6MjA4NjQ1MzUxN30.HCLQGntEJXJuOJT-NwZVgw0w7uBkjeR55dYXXY_ScuY"); // Ganti

// ===== Clock =====
function updateTime(){
  const now = new Date();
  const formatted = now.toLocaleString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});
  document.getElementById("datetime").innerText = formatted;
}
setInterval(updateTime,1000);
updateTime();

// ===== Kirim laporan =====
async function kirim(){
  const btn=document.getElementById("btnKirim");
  const spinner=document.getElementById("spinner");
  const nama=document.getElementById("nama").value.trim();
  const alamat=document.getElementById("alamat").value.trim();
  const keluhan=document.getElementById("keluhan").value.trim();
  const fileInput=document.getElementById("foto");

  if(!nama||!alamat||!keluhan){
    alert("Isi semua field sebelum mengirim!");
    return;
  }

  btn.disabled=true;
  spinner.style.display="inline-block";
  btn.firstChild.textContent="Mengirim...";

  let foto_url = "";
  if(fileInput.files.length>0){
    const file = fileInput.files[0];
    const fileName = Date.now()+"_"+file.name;
    const { data, error } = await supabase.storage.from('Komplen').upload(fileName, file);
    if(error){ alert("Upload foto gagal"); btn.disabled=false; spinner.style.display="none"; btn.firstChild.textContent="Kirim Laporan"; return; }
    foto_url = supabase.storage.from('Komplen').getPublicUrl(fileName).data.publicUrl;
  }

  const { data, error } = await supabase.from('Komplen').insert([{Nama:nama,Alamat:alamat,Keluhan:keluhan,"Foto Modem":foto_url}]);
  if(error){ alert("Simpan data gagal"); btn.disabled=false; spinner.style.display="none"; btn.firstChild.textContent="Kirim Laporan"; return; }

  // ===== Notif Telegram =====
  const telegramToken = "8166565066:AAG6EOZJpt6HCpGSmSjNkn0d3mQ7fYzkB_s";
  const chatId = "-5202580187";
  let message = `ðŸ“¢ KOMPLAIN BARU\nðŸ‘¤ ${nama}\nðŸ“ ${alamat}\nðŸ’¬ ${keluhan}`;
  if(foto_url) message += `\nðŸ–¼ Foto: ${foto_url}`;

  fetch(`https://api.telegram.org/bot${telegramToken}/sendMessage`, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({chat_id: chatId, text: message})
  }).then(()=>console.log("Notif Telegram terkirim")).catch(()=>console.log("Notif Telegram gagal"));

  document.getElementById("formBox").style.display="none";
  document.getElementById("successBox").style.display="block";
}
</script>
</body>
</html>
